#!/bin/sh

PREFIX=""
LOGGING='{"appender": {"type": "stdout"}, "levels": {"com.palm.pop": "debug", "com.palm.pop.client": "debug", "com.palm.pop.session": "debug", "com.palm.mail": "debug"}}'

for arg in "$@"; do
  case "$arg" in
  -kill)     while killall -q mojomail-pop; do echo "Killed existing mojomail-pop"; done ;;
  -run)      PREFIX="" ;;
  -gdb)      PREFIX="gdb --args" ;;
  -rungdb)   PREFIX="gdb -ex run --args" ;;
  -valgrind) PREFIX="valgrind --tool=memcheck" ;;
  -syslog)   LOGGING="`echo "$LOGGING" | sed 's/stdout/syslog/g'`" ;;
  -quiet)   LOGGING="`echo "$LOGGING" | sed 's/debug/info/g'`" ;;
  esac
done

CONFIG='{"log": '"$LOGGING"'}'

exec $PREFIX mojomail-pop -c "$CONFIG"