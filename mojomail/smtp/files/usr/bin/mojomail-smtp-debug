#!/bin/sh

PREFIX=""
LOGGING='{"appender":{"type":"stderr"},"levels":{"com.palm.smtp":"debug", "com.palm.mail": "debug"}}'
TIMEOUT='0'

for arg in "$@"; do
  case "$arg" in
  -kill)     while killall -q mojomail-smtp; do echo "Killed existing mojomail-smtp"; done ;;
  -run)      PREFIX="" ;;
  -gdb)      PREFIX="gdb --args" ;;
  -rungdb)   PREFIX="gdb -ex run --args" ;;
  -valgrind) PREFIX="valgrind --tool=memcheck" ;;
  -syslog)   LOGGING="`echo "$LOGGING" | sed 's/stderr/syslog/g'`"
  esac
done

CONFIG='{"log": '"$LOGGING"', "inactivityTimeoutSeconds": '"$TIMEOUT"'}'

exec $PREFIX mojomail-smtp -c "$CONFIG"